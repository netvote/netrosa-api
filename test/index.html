<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="netrosa-test.css">
</head>

<body>
    <form id="form-id">

        <!-- Aggregate Server Settings -->
        <h4>Server Settings</h4>
        <label>User: <input type="text" id="username" name="username"></label>
        <label> Password: <input type="password" id="password" name="password"></label>
        <label>Server: <input type="url" id="server" name="server" value="http://odk.netvote.io"></label>
        <input type="button" value="Save" id="save-button-id" />

        <!-- Upload New XForm -->
        <p>
            </br>
            <h4>Upload New ODK XForm definition (xml file):</h4>
            <input id="file-id" type="file" name="our-file" />
            <input type="button" value="Upload" id="upload-button-id" />
        </p>

        <!-- Form List Retrieval -->
        <p>
            </br>
            <h4>Current ODK XForms</h4>
            <input type="button" value="Get Forms" id="flist-button-id" />
        </p>

        <!-- Submission List Retrieval -->
        <p>
            </br>
            <h4>Current ODK Submissions</h4>
            <input type="button" value="Get Submissions" id="sublist-button-id" />
        </p>

        <script type="module">
            "use strict";

            import { NetRosa } from '../lib/netrosa-odk-api.js';
            import * as Utils from '../lib/utils.js';
            import * as FormHandlers from '../lib/formHandlers.js';

            // // ---------------------------------------------------------------------------------------------
            // // ---------------------------------------------------------------------------------------------
            // //
            // // NetRosa - ODK Aggregate Server Interface Test
            // // 
            // // ---------------------------------------------------------------------------------------------
            // //
            // // [REQUIRED SETTINGS]
            // //
            // //  username/password: 
            // //      This is your Aggregate account credentials with Form Manager or greater capabilities. 
            // //      The account type in Aggregate has to be ODK, not Google. 
            // //      You may leave these blank if your Aggregate instance allows anonymous form uploading.
            // //
            // //  server:
            // //      ODK Aggregate Instance URI
            // //
            // // ---------------------------------------------------------------------------------------------
            // //ODK Default Settings
            let serverSettings = {
                username: 'keith',
                password: 'D@t@m@n18',
                server: 'http://odk.netvote.io'
            };

            // //Instantiate NetRosa w/ ODK Default Settings
            let odk = new NetRosa(serverSettings);

            // ---------------------------------------------------------------------------------------------
            // Setup/Initialize Form Listeners
            // ---------------------------------------------------------------------------------------------
            FormHandlers.initFormUpload(odk);
            FormHandlers.initGetFormList(odk);
            FormHandlers.initGetSubFormList(odk);
            initSaveSettings();

            // ---------------------------------------------------------------------------------------------
            // Save/Update Aggregate Server Settings
            // ---------------------------------------------------------------------------------------------
            export function initSaveSettings() {
                var saveButton = document.getElementById("save-button-id");

                saveButton.onclick = function () {

                    let serverSettings = {
                        username: document.getElementById("username").value,
                        password: document.getElementById("password").value,
                        server: document.getElementById("server").value
                    };

                    //Display Aggregate Server - footer
                    Utils.displayFooterURL(`${serverSettings.server}`);

                    //Reconfigure NetRosa API 
                    odk = new NetRosa(serverSettings);

                    //Re-Init Handlers
                    FormHandlers.initFormUpload(odk);
                    FormHandlers.initGetFormList(odk);
                    FormHandlers.initGetSubFormList(odk);

                    Utils.displayMessage('Settings saved');

                    // Avoid normal form submission
                    return false;
                }
            }
        </script>

        <!-- Modal Results-->
        <div id="Modal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <pre id="modalresult"></pre>
                </pre>
            </div>
        </div>

    </form>
    <div class="footer">
        <p id="footer">Unconfigured NetRosa ODK Test Harness</p>
    </div>
</body>

</html>